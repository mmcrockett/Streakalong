<% @page_title = "Activities" %>
  <div ng-controller="ActivitiesController" class="navbar navbar-default" style="background-color:#FFFFFF;padding:5px 5px;" ng-init="initialize(<%= Item::ALL.to_json %>)">
    <%= render :partial => "common/nav_bar" %>
    <%= render :partial => "common/item_bar" %>
    <div class="streak-error">
      <p class="small text-muted bg-danger" ng-show="error">!ERROR: {{error}}</p>
    </div>
    <div>
      <button class="calendar-nav calendar-nav-left" ng-click="change_date(-1)"></button>
      <button class="calendar-nav calendar-nav-today" ng-click="change_date(0)"></button>
      <button class="calendar-nav calendar-nav-right" ng-click="change_date(1)"></button>
      <%= render :partial => "common/datepicker" %>
      <div class="calendar-nav" style="float:right;margin-right:10px;" ng-show="(0 != thinking)">
        <p class="small text-warning text-bold">saving...</p>
      </div>
    </div>
    <div class="navbar navbar-default container-fluid">
      <div class="row">
        <div ng-repeat="rel_date in display_dates" streakalong-ng-droppable="{hoverClass: 'daydata-active'}" ng-class="{'col-sm-4 datebox default-border-color': true, 'hidden-xs':$last || $first, 'leftdatebox':$first, 'rightdatebox':$last, 'centerdatebox':!$first && !$last, 'today':is_today(rel_date)}">
          <div class="text-center text-muted default-border-color dayindicator">{{rel_date | date : 'EEE'}}</div>
          <div class="text-right text-muted dateindicator" style="padding-right:4px;"><small>{{rel_date | date : 'MMM d'}}</small></div>
          <div class="text-muted small" style="width:100%;height:100%;" ng-if="!activities[rel_date]" ng-init="load_activities(rel_date)">
              <%= image_tag("/assets/indicator_large.gif", :style => "margin-left:42%;margin-top:32px;") %>
          </div>
          <div ng-repeat="item in activities[rel_date] | orderBy:'item_id'" ng-if="item.amount != 0" ng-class="{'daydata-container': true, 'bg-danger': item.error}" ng-dblclick="process_amount('-1',item.item_id,rel_date)">
            <%= render :partial => "common/item_image", :locals => {:category => 'daydata', :type => '{{items[item.item_id]}}', :id => '{{item.item_id}}'} %>
            <div class="count text-center" title="click to edit" item-id="{{item.item_id}}" streakalong-ng-editable>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/ng-template" id="streakalong-ng-editable-template">
    <span ng-hide="editorEnabled">{{item.amount}}</span>
    <form class="streakalong-edit" ng-show="editorEnabled">
      <input autocomplete="off" name="value" style="width:30px;" value="{{item.amount}}">
    </form>
  </script>
